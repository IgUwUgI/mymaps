<!doctype html>

<head>
    <link rel="stylesheet" href="../sideBar.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
</head>

<body>
    <div class="text">Tour du Cantal en 3 jours</div>
    <div id="sideContent">
        CONTENU TEST
        <canvas id="profilAlti" style="width:100%;max-width:700px;background:rgba(255,255,255,1.0)"></canvas>
        <script type="module">
            import HikesTraces from "./Transports/indexHike.js";
            import "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js";
            import {mymapX} from "../../modules/fonctions_transverses.js"

            var rando = HikesTraces.get("15-PuyMary");

            var xValues = new Array();
            var yValues = new Array();
            var xyValues = new Array();
            var xValues15 = new Array();
            var yValues15 = new Array();
            var xyValues15 = new Array();
            
            var coordinates = rando.features[0].geometry.coordinates;

            xValues.push(0);
            yValues.push(coordinates[0][2])
            xyValues.push({x:0, y:0})

            for (var i = 1; i < coordinates.length; i++) {
                var R = 6371;
                var latlng1 = [coordinates[i-1][1], coordinates[i-1][0]];
                var latlng2 = [coordinates[i][1], coordinates[i][0]];
                var dlat = (latlng2[0] - latlng1[0]) * Math.PI / 180;
                var dlng = (latlng2[1] - latlng1[1]) * Math.PI / 180;
                var a = Math.sin(dlat/2) * Math.sin(dlat/2) + Math.cos(latlng1[0] * Math.PI / 180) * Math.cos(latlng2[0] * Math.PI / 180) * Math.sin(dlng/2) * Math.sin(dlng/2);
                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                var d = (R * c)
                var appendD = (xValues[i - 1] + d).toFixed(2)
                console.log(appendD)
                if (100 * (coordinates[i][2] - coordinates[i - 1][2]) / (d * 1000) > 15){
                    xValues15.push(parseFloat(appendD));
                    yValues15.push(coordinates[i][2])
                    xyValues15.push({x:xValues15[i], y:yValues15[i]})
                } else {
                    xValues.push(parseFloat(appendD));
                    yValues.push(coordinates[i][2])
                    xyValues.push({x:xValues[i], y:yValues[i]})
                }
            }
            console.log(xValues)

            new Chart("profilAlti", {
                type: "scatter",
                data: {
                    datasets: [{
                    backgroundColor:"rgba(0,0,255,1.0)",
                    pointRadius: 0.7,
                    borderColor: "rgba(0,0,255,0)",
                    data: xyValues,
                    order: 2
                    }
                    // {
                    // backgroundColor:"rgba(255,0,0,1.0)",
                    // pointRadius: 0.7,
                    // borderColor: "rgba(255,0,0,0)",
                    // data: xyValues15,
                    // order: 1
                    // }
                ]
                },
                options:{
                    legend: {display: false},
                    showLine: true
                }
                });

        </script>
    </div>
</body>